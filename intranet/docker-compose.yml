#docker stack deploy -c docker-compose.yml --with-registry-auth trajano
#docker run -v noriko/s/letsencrypt:/etc/letsencrypt --volume-driver cifs trajano.net/web
version: '3.4'
services:
  intranet:
    image: trajano.net/intranet
    deploy:
      replicas: 2
      restart_policy:
        condition: any
        delay: 10s
      placement:
        constraints:
          - node.role != manager
    ports:
    - "444:443"
    volumes:
    - letsencrypt:/etc/letsencrypt
    environment:
    - TZ=America/Toronto
    - HTTPVAL=true
    networks: 
    - public
    - default
    - mon
  dashboard:
    image: charypar/swarm-dashboard
    volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    environment:
      PORT: 8080
    deploy:
      replicas: 1
      placement:
        constraints:
        - node.role == manager
volumes:
  letsencrypt:
    name: 'noriko/s/letsencrypt'
    driver: cifs
networks:
  mon:
    external:
      name: mon_net
  public:
    external:
      name: public
